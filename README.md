# 使用技術
- Ruby 2.6.5
- Ruby on Rails 6.0.3
- Vue.js 2.6.14
- PostgreSQL 11.2
- Heroku
- Puma
- Docker/Docker-compose
- CircleCi CI/CD
- Bootstrap5
- RSpec(最下部にテスト一覧を載せております。)

# Metista
学生が学習参考書、問題集で躓いた所やわからない所を簡便に教師に質問することができるアプリケーションです。

学校全体で導入するアプリケーション、ということを想定し作成致しました。アプリ内で教職員側、生徒側と分かれています。

教職員は生徒が質問するであろう参考書、問題集(例えば高校数学なら"一対一対応の数学"や"やさしい理系数学"等)の登録編集、生徒情報の閲覧、登録編集、及びログイン情報の閲覧ができます。

生徒は教職員が予め登録しておいた書籍を選択し、質問することができます。

解決済みの質問は匿名で公開されますので、生徒側は過去の同じような質問を簡単に検索し解決でき、教職員側は生徒がどの本の、どの単元、問題が躓きやすいか把握できます。
つまりDB化されますので今後の学習、教育に役立てることができます。

(このアプリケーションを作成した理由は下部に記述しておりますのでお時間あれば目を通していただけると幸甚です。)

# URL、ログイン
ゲストアカウントをご利用できます。

ログインフィールドに初期値が入力されていますのでそのままログインしていただけます。

### [教職員入り口はこちら](https://heroku-metista.herokuapp.com/teacher)

### [生徒入り口はこちら](https://heroku-metista.herokuapp.com/mypage)

(ゲストアカウントは自身のアカウント情報及びパスワード変更機能は利用できないようになっています。)


# 主な機能
### 質問投稿機能(下記にDEMOのGifを貼り付けてあります。)
- 生徒は質問したい参考書問題集、各大学の過去問(年度別科目別)を検索し、教師に質問することができる。
- 教師は自分の担当科目の質問に対して回答を投稿することができる。
- 質問が解決した場合、質問をクローズすることができる。クローズすると匿名で公開され、他の生徒がその質問を検索することができるようになる。(クローズしていない状態では教師以外閲覧はできない。)
### 書籍管理機能
- 教師は生徒が質問する書籍を新規登録、編集することができる。
### 学生管理機能
- 教師は学生を学生番号、氏名、電話番号、クラス、生年月日、本人または両親の住所から検索することができる。
- 同様に学生を新規登録することができる。
- 教師は学生のログインログアウト記録を確認することができる。学生別、または全ての学生の記録を時系列で閲覧することができる。
### お知らせ掲示板機能
- 教師はお知らせ掲示板に記事を投稿することができる。投稿者本人は編集及び削除ができる。
- 学生は閲覧のみ。文系、理系、全体のタグがあり、学生は属するタグの記事のみ表示される。
### アカウント機能
- 教師は自らのアカウント情報を表示、編集することができる。ログインパスワードも同様にして変更することができる。
- 生徒は表示のみで編集することはできない。教師側から変更編集する必要がある。
- ゲストアカウントでは悪戯防止のため、自分の情報及びパスワードは変更できないようにしてある。

# DEMO
メインである質問投稿機能のデモです。

![demo](https://gyazo.com/9ee58268934b7162a3d6a1afa2476fa2/raw)
生徒側でゲストログインし、質問する・似たような質問を探すをクリックします。



![demo](https://gyazo.com/cb2c7df18ecb38db5cfa53c616c5fa45/raw)
質問したい書籍を検索し選択します。
このgifでは東京大学、2007年度、数学の過去問を検索し選択しています。



![demo](https://gyazo.com/5512a6aa523826819e5afeeaf29abba5/raw)
タイトル、質問内容を投稿します。現時点では数学を担当に持つ教師にのみ公開されます。他の生徒には公開されません。



![demo](https://gyazo.com/fbe5dc01bc5d106b901beb6dc1463099/raw)
教師側でゲストログインし、質問に答える、をクリックすると回答受付中の質問が表示されます。(ゲストアカウントは数学を担当科目として持っているので数学の質問のみ表示されます。)
対象の質問をクリックすると、詳細が表示されます。



![demo](https://gyazo.com/1084b459445574dc0c269fa94af75f40/raw)
回答を投稿します。



![demo](https://gyazo.com/faa82ee2590d4e3f1b78273583001297/raw)
生徒側で、自分がした過去の質問を見る、をクリックすると自分の質問一覧が表示されます。詳細ページではその質問に対しての回答がツリー形式で表示されます。



![demo](https://gyazo.com/4cc3d5a8a7f348700146b337d7813ec4/raw)
生徒はさらにコメント、追記することができます。
解決済みにチェックを入れて投稿すると、当質問への投稿を締め切ることができます。

投稿を締め切ると教師、生徒双方がその質問へ投稿ができなくなります。
また、他の生徒がその質問を検索し、閲覧できるようになります。

このことによって過去に似たような質問があるかどうか検索できるようになり、質問をせずとも参考にすることができます。

## 工夫したところ
- routes.rbにてnamespaceを使い、生徒側と教師側のURL及びファイル構成を切り分け、分かりやすく円滑に開発できるようにした。
- プレゼンターを導入し、viewの記述を簡潔にした。またプレゼンターモデルにdelegateを使用し、さらに簡潔に記述できるようにした。
- 同じくフォームプレゼンターを導入し、煩雑になりがちなフォームを簡潔に記述かつ、使いまわせるようにした。
- Vueのテンプレート構文を利用し、formのdisabled属性を切り替えられるようにした。当初はjQueryでの実装だったが、これにより簡潔で行数も少ない記述となった。
- 単一テーブル継承(STI)を使用した。生徒は本人住所と親の住所が異なる場合がある。これを用いて同一テーブルにて二種類の住所を表現できるようにした。
- フォームオブジェクトを導入した。ビジネスロジックを切り分け、モデル、コントローラの記述を簡潔にし、可読性を向上させた。
- 半角カナ→全角カナ、冒頭の空白を削除する等の正規化を行うStringNormalizerをmodule化し、各モデルで使いまわせるようにした。
- 投稿前に確認できるよう投稿確認画面を実装した。routes.rbにてon: :collection、フォームにてhidden_fieldを利用した。
- レスポンシブデザインを適用した。教師はPC及び画面の比較的小さな端末(タブレット含む)利用を想定しており、サイドメニューバーが出るようになっている。生徒はPC及びスマホ利用を想定し、フッターメニューが出るようになっている。どちらもブレイクポイントは992pxに設定してある。
- (教師側のみ)sessionメソッドを使い、時間経過(60分)による自動ログアウト機能を実装した。教師側は共用端末を利用することを想定している為。
- (生徒側のみ)cookieの値を利用し、次回から自動ログイン機能を実装した。生徒側は基本的に個人持ちの端末を利用することを想定している為。

### CircleCi CI/CD
- GitHubへのpush時にbuild及びtestが実行されます。
- Masterブランチへマージした際にbuild及びtestが成功した場合、herokuへの自動デプロイが実行されます。

## どうしてこのアプリを作ったのか、プログラミングを勉強したのか
### 医学部再受験

2015/9-2019/3まで医師を志し、国公立医学部の再受験をしていました。
2016~2018年は予備校も無い田舎の地元に戻り、独学で勉強していました。周りに同じ志を持つ人は勿論おらず、SNSでモチベーションを維持しつつ勉学に励んでいました。
ですが、分からず詰まったところがあっても気軽に質問し解決する場がありませんでした。(質問掲示板等はあったのですが、質問内容から逸脱した回答が多かったりし、非常に解決に時間がかかるなど難儀していました。)
最終的にはセンター試験87%をとり、地方国公立医学部のボーダーラインは超えたのですが、二次試験を通過できず、最終的に諦めることとなりました。
### 私の中高校の話
一方、私の通った北嶺中高は非常に手厚い学習支援を行っていました。
進学校の私立中高にしては偏差値は高くないのですが、120名中、30-40人が東大及び国公立医学部に進学します。これは一重に先生方がご指導に尽力した結果だと今振り返って思います。
私は中高6年間、あまり勤勉な学生ではなかったのですが受験期に先生達の御支援で明治大学に合格致しました。(そこから浪人して上の大学を受験しましたが、最終的に明治大学に進学する運びとなりました。)

### 上記を踏まえて
私は予備校も無い、誰かに質問することもできない、同じ志を持つ人が側にいない田舎、一方で質問すればすぐ答えてくれる同志や先生達がいる都市部の学校、両方での受験を経験いたしました。

多くの人は受験期間か限られています。浪人が許されない人、一浪以上は許されない人、私のように〇〇年やったら諦めよう、という人。
限られた期間で早く実力をつけるには本人の努力以外にも成長しやすい環境も必要かと思います。

少しでも、なりたい自分になれる人が増えるよう、このアプリを作成致しました。

# ER図
![metista_er](https://user-images.githubusercontent.com/55440063/142962907-4b9bef4b-9d98-4885-8269-8f7744e6a24a.png)


# テストコード(Rspec)
## spec/model
### student_member_spec.rb
- 文字列を与えるとhashed_passwordは長さ60の文字列になる
- nilを与えると、hashed_passwordはnilになる
- stundent_numberの前後の空白を除去
- stundent_numberの全角数字を半角文字に変換
- family_name_kanaに含まれる平仮名をカタカナに変換
- family_name_kanaに含まれる半角カナを全角カナに変換
- emergency_contactの前後の空白を除去
- emergency_contactの全角数字を半角文字に変換
- email前後の空白を除去
- emailに含まれる全角英数字を半角英数字に変換
- email前後の全角英数字を除去
- family_name_kanaに漢字が含まれていた場合無効
- family_name_kanaに長音符が含まれていても有効
- family_nameに英字が含まれていても有効
- family_nameに記号が含まれていると無効
- family_name_kanaに長音符が含まれていても有効
- birth_dayには未来の日付は設定できない
- @を2個含むemailは無効
- 他のstudentとemailが重複している場合は無効
- 他のstudentとstudent_numberが重複している場合は無効
### teacher_member_spec.rb
- 文字列を与えるとhashed_passwordは長さ60の文字列になる
- nilを与えると、hashed_passwordはnilになる
- family_name_kanaに含まれる平仮名をカタカナに変換
- family_name_kanaに含まれる半角カナを全角カナに変換
- email前後の空白を除去
- emailに含まれる全角英数字を半角英数字に変換
- email前後の全角英数字を除去
- family_name_kanaに漢字が含まれていた場合無効
- family_name_kanaに長音符が含まれていても有効
- family_nameに英字が含まれていても有効
- family_nameに記号が含まれていると無効
- family_name_kanaに長音符が含まれていても有効
- birth_dayには未来の日付は設定できない
- @を2個含むemailは無効
- 他のteacherとemailが重複している場合は無効
### book_spec.rb
- book_nameに含まれる前後の空白を除去
- book_nameに含まれる半角カナを全角カナに変換
- book_nameに含まれる全角数字を半角文字に変換
- book_nameが空欄の場合無効
- book_subjectが空欄の場合無効
- book_typeが空欄の場合無効
### question_spec.rb
- titleに含まれる前後の空白を除去
- titleに含まれる半角カナを全角カナに変換
- titleに含まれる全角数字を半角文字に変換
- bodyに含まれる前後の空白を除去
- bodyに含まれる半角カナを全角カナに変換
- bodyに含まれる全角数字を半角文字に変換
- titleが空欄の場合無効
- bodyが空欄の場合無効
### answer_spec.rb
- bodyに含まれる前後の空白を除去
- bodyに含まれる半角カナを全角カナに変換
- bodyに含まれる全角数字を半角文字に変換
- bodyが空欄の場合無効
### board_message_spec.rb
- subjectに含まれる前後の空白を除去
- subjectに含まれる半角カナを全角カナに変換
- subjectに含まれる全角数字を半角文字に変換
- bodyに含まれる前後の空白を除去
- bodyに含まれる半角カナを全角カナに変換
- bodyに含まれる全角数字を半角文字に変換
- subjectが空欄の場合無効
- bodyが空欄の場合無効
## spec/features (Capybara) 
### student/question_spec.rb
- 生徒が質問する書籍を検索する
- 生徒が質問を投稿する
- 質問の際、タイトルは空欄にできない。(バリデーションエラーメッセージテスト)
- 質問の際、タイトルと本文両方空欄にはできない。(バリデーションエラーメッセージ同時表示のテスト)
### teacher/board_message_spec.rb
- 教職員が掲示板投稿機能を用い、題名、本文、タグ付けをし確認画面に遷移し、投稿する
- 題名を空欄にすると投稿できない(バリデーションエラーメッセージ表示テスト)
- 複数の項目を空欄にすると、複数のバリデーションエラーメッセージが表示される
- 教職員が投稿済みの内容を編集する
- 教職員が投稿済みの内容を空白にすると編集投稿できない
### teacher/book_spec.rb
- 教職員が書籍登録をする
- 書籍登録の際、書籍名は空欄にできない(バリデーション及びそのメッセージ表示テスト)
- 書籍登録の際、複数の項目を空欄にすると、複数のバリデーションエラーメッセージが同時に表示される。
### teacher/student_member_management_spec.rb
- 教職員が生徒情報、住所を新規登録する
- 教職員が生徒情報、住所を更新する
- 教職員が生徒情報、住所を更新する際、student_memberに適切な値、student_member.home_addressに不適切な値を入れた場合、両方とも更新されない
- 教職員がfamily_name_kanaを用いて生徒情報を検索する。
- 教職員が電話番号を用いて生徒情報を検索する。電話番号フォームからtelephone_number,emergency_contactどちらのカラムも検索することができる。本テストはtelephone_numberから
- 教職員が電話番号を用いて生徒情報を検索する。電話番号フォームからtelephone_number,emergency_contactどちらのカラムも検索することができる。本テストはemergency_contactから"
- 教職員がハイフン入りの電話番号を用いて生徒情報を検索する。(正規化のテスト)
## spec/request
### student/auto_login_spec.rb
- チェックボックスをオフにした場合
- チェックボックスをオンにした場合
### teacher/my_account_management_spec.rb
- 自身の情報表示
- 停止フラグがセットされたら強制的にログアウト
- セッションタイムアウト
- emailを変更する
- end_dateの書き換えは不可
### teacher/student_member_management_spec.rb
- 生徒の新規登録後、生徒一覧にリダイレクト
- 生徒にsuspendedフラグをセットする
- hashed_passwordの書き換え不可
## spec/services
### student/authenticator_spec.rb
- 正しいパスワードならtrueを返す
- 誤ったパスワードならfalseを返す
- パスワードが未設定ならfalseを返す
- 停止フラグが立っていればfalseを返す
- 入学日が明日ならfalseを返す
- 卒業日を過ぎているならfalseを返す
### teacher/authenticator_spec.rb
- 正しいパスワードならtrueを返す
- 誤ったパスワードならfalseを返す
- パスワードが未設定ならfalseを返す
- 停止フラグが立っていればfalseを返す
- 入職日が明日ならfalseを返す
- 退職日を過ぎているならfalseを返す
